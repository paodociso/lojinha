<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo v3.3 | Pão do Ciso</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --bg-creme: #fdf5e6;
            --verde-militar: #2d3a27;
            --verde-claro: #4a5d42;
            --marrom-cafe: #2e2610;
            --texto: #3e2723;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f1ea;
            color: var(--texto);
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--verde-militar);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar h4 {
            font-weight: 700;
            margin-bottom: 30px;
            color: #dccbb0;
            border-bottom: 1px solid #4a5d42;
            padding-bottom: 15px;
        }

        .nav-btn {
            background: none;
            border: none;
            color: #ccc;
            text-align: left;
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-btn.active {
            background: var(--bg-creme);
            color: var(--verde-militar);
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Área Principal */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background-color: #f4f1ea;
        }

        .section-pane {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section-pane.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card-custom {
            background: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            padding: 20px;
        }

        /* Header da Seção */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .page-header h2 {
            color: var(--verde-militar);
            font-weight: 700;
            margin: 0;
        }

        /* Cards de Opcionais */
        .opcional-group {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid var(--verde-militar);
        }

        .opcional-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .opcional-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 8px;
            position: relative;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h4><i class="fas fa-bread-slice"></i> Gestão Ciso</h4>
        
        <button class="nav-btn active" onclick="navegar('dashboard')">
            <i class="fas fa-chart-line"></i> Início
        </button>
        <button class="nav-btn" onclick="navegar('produtos')">
            <i class="fas fa-utensils"></i> Produtos
        </button>
        <button class="nav-btn" onclick="navegar('opcionais')">
            <i class="fas fa-list"></i> Opcionais
        </button>
        <button class="nav-btn" onclick="navegar('logistica')">
            <i class="fas fa-motorcycle"></i> Logística
        </button>
        <button class="nav-btn" onclick="navegar('fornada')">
            <i class="fas fa-calendar-alt"></i> Fornada
        </button>

        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid #4a5d42;">
            <button class="btn btn-light w-100 fw-bold" onclick="baixarDados()">
                <i class="fas fa-download"></i> Baixar JS
            </button>
        </div>
    </div>

    <div class="main-content">
        
        <div id="pane-dashboard" class="section-pane active">
            <div class="page-header">
                <h2>Bem-vindo ao Painel</h2>
            </div>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 
                Para começar, carregue o arquivo <strong>dados.js</strong> atual do seu computador.
            </div>

            <div class="card-custom text-center py-5">
                <i class="fas fa-file-code fa-3x text-muted mb-3"></i>
                <h3>Carregar Dados Atuais</h3>
                <p class="text-muted">Selecione o arquivo dados.js da pasta do projeto</p>
                <input type="file" id="fileInput" class="form-control w-50 mx-auto" accept=".js">
            </div>
        </div>

        <div id="pane-produtos" class="section-pane">
            <div class="page-header">
                <h2>Gestão de Produtos</h2>
                <button class="btn btn-success" onclick="salvarAlteracoesGlobal()">
                    <i class="fas fa-save"></i> Salvar Tudo
                </button>
            </div>
            <div id="lista-secoes-produtos">
                </div>
        </div>

        <div id="pane-opcionais" class="section-pane">
            <div class="page-header">
                <h2>Biblioteca de Opcionais</h2>
            </div>
            <div id="lista-opcionais">
                </div>
        </div>

        <div id="pane-logistica" class="section-pane">
            <div class="page-header">
                <h2>Taxas de Entrega</h2>
                <button class="btn btn-primary" onclick="adicionarBairro()">
                    <i class="fas fa-plus"></i> Novo Bairro
                </button>
            </div>
            <div class="card-custom">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Taxa Padrão (R$)</label>
                        <input type="number" id="taxa-geral" class="form-control" onchange="atualizarTaxaGeral()">
                    </div>
                </div>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Bairro</th>
                            <th>Taxa (R$)</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-bairros">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="pane-fornada" class="section-pane">
            <div class="page-header">
                <h2>Configuração da Fornada</h2>
            </div>
            <div class="card-custom" style="max-width: 600px;">
                <div class="mb-3">
                    <label class="form-label">Data da Próxima Fornada</label>
                    <input type="date" id="data-fornada" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Dias de Antecedência para Pedido</label>
                    <input type="number" id="dias-antecedencia" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Hora Limite (Ex: 23:59h)</label>
                    <input type="text" id="hora-limite" class="form-control">
                </div>
                <button class="btn btn-success w-100" onclick="salvarFornada()">
                    Atualizar Datas
                </button>
            </div>
        </div>

    </div>

    <div class="modal fade" id="modal-editar-produto" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Produto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-indice-secao">
                    <input type="hidden" id="edit-indice-item">
                    
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label class="form-label">Nome</label>
                            <input type="text" id="edit-nome" class="form-control">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Preço (R$)</label>
                            <input type="number" id="edit-preco" class="form-control">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Descrição</label>
                        <textarea id="edit-descricao" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Categoria de Opcionais</label>
                            <select id="edit-categoria-opcional" class="form-select" onchange="atualizarCheckboxesOpcionais()">
                                <option value="">Nenhum (Produto Simples)</option>
                                </select>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="edit-esgotado">
                                <label class="form-check-label text-danger fw-bold" for="edit-esgotado">
                                    Produto Esgotado?
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="edit-visivel">
                                <label class="form-check-label" for="edit-visivel">
                                    Visível no Cardápio?
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-light">
                        <div class="card-body">
                            <h6>Opcionais Ativos neste Produto</h6>
                            <small class="text-muted d-block mb-2">Marque o que o cliente pode escolher.</small>
                            <div id="container-opcionais-produto" class="d-flex flex-wrap gap-2">
                                </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarProdutoEditado()">Salvar Alterações</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-add-opcional" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Novo Item Opcional</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nome do Item</label>
                        <input type="text" id="novo-opcional-nome" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Preço Adicional (R$)</label>
                        <input type="number" id="novo-opcional-preco" class="form-control" value="0">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="salvarNovoOpcional()">Adicionar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ============================================
        // LÓGICA DO PAINEL DE GESTÃO - v3.3
        // ============================================

        let db = {
            loja: {},
            fornada: {},
            entrega: { bairros: [] },
            cupons: [],
            opcionais: {},
            secoes: []
        };

        // --- INICIALIZAÇÃO E LEITURA DE ARQUIVO ---
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                try {
                    // Executa o JS do arquivo para carregar window.dadosIniciais
                    eval(content);
                    if (window.dadosIniciais) {
                        db = window.dadosIniciais;
                        alert('✅ Dados carregados com sucesso!');
                        navegar('dashboard'); // Recarrega UI
                        renderizarTudo();
                    }
                } catch (error) {
                    alert('Erro ao ler arquivo: ' + error.message);
                }
            };
            reader.readAsText(file);
        });

        function renderizarTudo() {
            renderizarLogistica();
            renderizarFornada();
            renderizarOpcionais();
            renderizarProdutos();
        }

        // --- NAVEGAÇÃO ---
        function navegar(painel) {
            document.querySelectorAll('.section-pane').forEach(el => el.classList.remove('active'));
            document.getElementById('pane-' + painel).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            event.target.closest('.nav-btn').classList.add('active');
        }

        // ============================================
        // 1. GESTÃO DE PRODUTOS
        // ============================================

        function renderizarProdutos() {
            const container = document.getElementById('lista-secoes-produtos');
            container.innerHTML = '';

            db.secoes.forEach((secao, idxSecao) => {
                let htmlItens = '';
                
                secao.itens.forEach((item, idxItem) => {
                    const statusClass = item.esgotado ? 'border-danger' : 'border-success';
                    const badge = item.esgotado 
                        ? '<span class="badge bg-danger">Esgotado</span>' 
                        : '<span class="badge bg-success">Disponível</span>';

                    htmlItens += `
                        <div class="col-md-6 col-lg-4">
                            <div class="card-custom h-100 ${statusClass}" style="border-left: 5px solid;">
                                <div class="d-flex justify-content-between mb-2">
                                    <h5 class="fw-bold">${item.nome}</h5>
                                    ${badge}
                                </div>
                                <p class="small text-muted mb-2">${item.descricao.substring(0, 60)}...</p>
                                <p class="fw-bold">R$ ${parseFloat(item.preco).toFixed(2)}</p>
                                <button class="btn btn-sm btn-outline-primary w-100 mt-auto" 
                                    onclick="abrirModalEditar(${idxSecao}, ${idxItem})">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                            </div>
                        </div>
                    `;
                });

                const secaoHtml = `
                    <div class="mb-5">
                        <h4 class="border-bottom pb-2 mb-3 text-uppercase text-muted">${secao.nome}</h4>
                        <div class="row g-3">
                            ${htmlItens}
                        </div>
                    </div>
                `;
                container.innerHTML += secaoHtml;
            });
        }

        function abrirModalEditar(idxSecao, idxItem) {
            const item = db.secoes[idxSecao].itens[idxItem];
            
            document.getElementById('edit-indice-secao').value = idxSecao;
            document.getElementById('edit-indice-item').value = idxItem;
            document.getElementById('edit-nome').value = item.nome;
            document.getElementById('edit-preco').value = item.preco;
            document.getElementById('edit-descricao').value = item.descricao;
            document.getElementById('edit-esgotado').checked = item.esgotado;
            document.getElementById('edit-visivel').checked = item.visivel;

            // Preencher Select de Categorias
            const selectCat = document.getElementById('edit-categoria-opcional');
            selectCat.innerHTML = '<option value="">Sem Opcionais</option>';
            Object.keys(db.opcionais).forEach(key => {
                const selected = (item.opcionais === key) ? 'selected' : '';
                selectCat.innerHTML += `<option value="${key}" ${selected}>${key}</option>`;
            });

            // Renderiza checkboxes baseado no que já está salvo
            renderizarSelecaoOpcionais(item.opcionais, item.opcionais_ativos);

            new bootstrap.Modal(document.getElementById('modal-editar-produto')).show();
        }

        // --- RENDERIZAÇÃO DOS CHECKBOXES (UPDATED v3.3) ---
        function atualizarCheckboxesOpcionais() {
            const categoria = document.getElementById('edit-categoria-opcional').value;
            renderizarSelecaoOpcionais(categoria, []);
        }

        function renderizarSelecaoOpcionais(categoriaOpcional, ativosAtuais) {
            const container = document.getElementById('container-opcionais-produto');
            container.innerHTML = '';

            if (!categoriaOpcional || !db.opcionais[categoriaOpcional]) {
                container.innerHTML = '<p class="text-muted w-100 text-center">Selecione uma categoria de opcionais válida acima.</p>';
                return;
            }

            const biblioteca = db.opcionais[categoriaOpcional];
            
            // Normaliza lista de ativos para Array
            let listaAtivos = [];
            if (Array.isArray(ativosAtuais)) {
                listaAtivos = ativosAtuais;
            } else if (typeof ativosAtuais === 'object' && ativosAtuais !== null) {
                Object.values(ativosAtuais).forEach(arr => listaAtivos.push(...arr));
            }

            let html = '';

            const criarCheckbox = (item) => {
                const isChecked = listaAtivos.includes(item.nome) ? 'checked' : '';
                return `
                    <div class="form-check mb-1" style="min-width: 45%;">
                        <input class="form-check-input check-opcional" type="checkbox" value="${item.nome}" id="opt_${item.nome.replace(/\s/g, '')}" ${isChecked}>
                        <label class="form-check-label small" for="opt_${item.nome.replace(/\s/g, '')}">
                            ${item.nome} <span class="text-muted">(+ R$ ${item.preco})</span>
                        </label>
                    </div>
                `;
            };

            // Lógica Híbrida: Árvore ou Lista
            if (Array.isArray(biblioteca)) {
                biblioteca.forEach(item => { html += criarCheckbox(item); });
            } else {
                for (const [subcategoria, itens] of Object.entries(biblioteca)) {
                    html += `<h6 class="w-100 mt-3 mb-2 border-bottom text-success small fw-bold">${subcategoria}</h6>`;
                    html += `<div class="d-flex flex-wrap gap-2 w-100">`;
                    itens.forEach(item => { html += criarCheckbox(item); });
                    html += `</div>`;
                }
            }

            container.innerHTML = html;
        }

        function salvarProdutoEditado() {
            const s = document.getElementById('edit-indice-secao').value;
            const i = document.getElementById('edit-indice-item').value;
            const item = db.secoes[s].itens[i];

            item.nome = document.getElementById('edit-nome').value;
            item.preco = parseFloat(document.getElementById('edit-preco').value);
            item.descricao = document.getElementById('edit-descricao').value;
            item.esgotado = document.getElementById('edit-esgotado').checked;
            item.visivel = document.getElementById('edit-visivel').checked;
            
            const catOpcional = document.getElementById('edit-categoria-opcional').value;
            item.opcionais = catOpcional || null;

            // Coleta checkboxes marcados (sempre salva como Array Plano agora)
            const checks = document.querySelectorAll('.check-opcional:checked');
            item.opcionais_ativos = Array.from(checks).map(c => c.value);

            renderizarProdutos();
            bootstrap.Modal.getInstance(document.getElementById('modal-editar-produto')).hide();
        }

        // ============================================
        // 2. GESTÃO DE OPCIONAIS (UPDATED v3.3)
        // ============================================

        function renderizarOpcionais() {
            const container = document.getElementById('lista-opcionais');
            container.innerHTML = '';

            for (const [categoria, conteudo] of Object.entries(db.opcionais)) {
                
                let htmlItens = '';

                // Verifica se é Lista Simples ou Árvore
                if (Array.isArray(conteudo)) {
                    if (conteudo.length === 0) {
                        htmlItens = '<p class="text-muted">Nenhum item nesta categoria.</p>';
                    } else {
                        conteudo.forEach((item, index) => {
                            htmlItens += criarCardOpcionalHTML(categoria, null, item, index);
                        });
                    }
                } else {
                    // Modo Árvore (Subcategorias)
                    for (const [subcategoria, itens] of Object.entries(conteudo)) {
                        htmlItens += `<h6 class="w-100 mt-3 mb-2 pb-1 border-bottom text-success"><i class="fas fa-folder-open"></i> ${subcategoria}</h6>`;
                        
                        if (itens.length === 0) {
                            htmlItens += '<p class="text-muted small">Vazio</p>';
                        } else {
                            itens.forEach((item, index) => {
                                htmlItens += criarCardOpcionalHTML(categoria, subcategoria, item, index);
                            });
                        }
                    }
                }

                const div = document.createElement('div');
                div.className = 'opcional-group';
                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="m-0 text-success">${categoria}</h3>
                        <button class="btn btn-sm btn-outline-success" onclick="abrirModalAddOpcional('${categoria}')">
                            <i class="fas fa-plus"></i> Novo Item
                        </button>
                    </div>
                    <div class="opcional-grid">
                        ${htmlItens}
                    </div>
                `;
                container.appendChild(div);
            }
        }

        function criarCardOpcionalHTML(catPrincipal, subCat, item, index) {
            const argsRemover = subCat 
                ? `'${catPrincipal}', '${subCat}', ${index}` 
                : `'${catPrincipal}', null, ${index}`;

            return `
                <div class="opcional-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong class="text-truncate" style="max-width: 120px;">${item.nome}</strong>
                        <span class="badge bg-light text-dark border">R$ ${item.preco}</span>
                    </div>
                    <div class="mt-2 text-end">
                        <button class="btn btn-sm btn-link text-danger p-0" onclick="removerOpcional(${argsRemover})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>`;
        }

        let categoriaAdicaoAtual = '';

        function abrirModalAddOpcional(categoria) {
            categoriaAdicaoAtual = categoria;
            const modalBody = document.querySelector('#modal-add-opcional .modal-body');
            
            // Remove seletor anterior se existir
            const wrapperAntigo = document.getElementById('wrapper-subcategoria');
            if (wrapperAntigo) wrapperAntigo.remove();

            // Se for Árvore, cria o Select de Subcategoria
            if (!Array.isArray(db.opcionais[categoria])) {
                let options = '';
                for (const sub of Object.keys(db.opcionais[categoria])) {
                    options += `<option value="${sub}">${sub}</option>`;
                }
                const selectHtml = `
                    <div class="mb-3" id="wrapper-subcategoria">
                        <label class="form-label fw-bold">Selecione a Subcategoria</label>
                        <select id="novo-opcional-subcategoria" class="form-select">
                            ${options}
                        </select>
                    </div>`;
                modalBody.insertAdjacentHTML('afterbegin', selectHtml);
            }

            document.getElementById('novo-opcional-nome').value = '';
            document.getElementById('novo-opcional-preco').value = '';
            new bootstrap.Modal(document.getElementById('modal-add-opcional')).show();
        }

        function salvarNovoOpcional() {
            const nome = document.getElementById('novo-opcional-nome').value;
            const preco = parseFloat(document.getElementById('novo-opcional-preco').value);
            const elSub = document.getElementById('novo-opcional-subcategoria');
            const subcategoria = elSub ? elSub.value : null;

            if (!nome || isNaN(preco)) {
                alert('Preencha nome e preço corretamente.');
                return;
            }

            const novoItem = { nome, preco };

            if (subcategoria) {
                db.opcionais[categoriaAdicaoAtual][subcategoria].push(novoItem);
            } else {
                db.opcionais[categoriaAdicaoAtual].push(novoItem);
            }

            renderizarOpcionais();
            bootstrap.Modal.getInstance(document.getElementById('modal-add-opcional')).hide();
        }

        function removerOpcional(categoria, subcategoria, index) {
            if (!confirm('Excluir item?')) return;
            if (subcategoria) {
                db.opcionais[categoria][subcategoria].splice(index, 1);
            } else {
                db.opcionais[categoria].splice(index, 1);
            }
            renderizarOpcionais();
        }

        // ============================================
        // 3. LOGÍSTICA E FORNADA
        // ============================================

        function renderizarLogistica() {
            document.getElementById('taxa-geral').value = db.entrega.taxaGeral;
            const tbody = document.getElementById('tabela-bairros');
            tbody.innerHTML = '';
            
            db.entrega.bairros.forEach((bairro, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${bairro.nome}</td>
                        <td>R$ ${bairro.taxa}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removerBairro(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        function adicionarBairro() {
            const nome = prompt("Nome do Bairro:");
            if (!nome) return;
            const taxa = parseFloat(prompt("Taxa de Entrega (R$):"));
            if (isNaN(taxa)) return;

            db.entrega.bairros.push({ nome, taxa });
            renderizarLogistica();
        }

        function removerBairro(index) {
            db.entrega.bairros.splice(index, 1);
            renderizarLogistica();
        }

        function atualizarTaxaGeral() {
            db.entrega.taxaGeral = parseFloat(document.getElementById('taxa-geral').value);
        }

        function renderizarFornada() {
            document.getElementById('data-fornada').value = db.fornada.dataISO;
            document.getElementById('dias-antecedencia').value = db.fornada.diasAntecedencia;
            document.getElementById('hora-limite').value = db.fornada.horaLimite;
        }

        function salvarFornada() {
            db.fornada.dataISO = document.getElementById('data-fornada').value;
            db.fornada.diasAntecedencia = parseInt(document.getElementById('dias-antecedencia').value);
            db.fornada.horaLimite = document.getElementById('hora-limite').value;
            alert('Datas atualizadas!');
        }

        // ============================================
        // EXPORTAÇÃO (DOWNLOAD)
        // ============================================

        function gerarConteudoDadosJS() {
            let conteudo = "// ============================================\n";
            conteudo += "// DADOS DO SISTEMA - PÃO DO CISO\n";
            conteudo += "// ============================================\n\n";
            conteudo += "window.dadosIniciais = {\n";

            conteudo += `    loja: ${JSON.stringify(db.loja, null, 3)},\n\n`;
            conteudo += `    fornada: ${JSON.stringify(db.fornada, null, 3)},\n\n`;
            conteudo += `    entrega: ${JSON.stringify(db.entrega, null, 3)},\n\n`;
            conteudo += `    cupons: ${JSON.stringify(db.cupons, null, 3)},\n\n`;
            conteudo += `    opcionais: ${JSON.stringify(db.opcionais, null, 3)},\n\n`;
            conteudo += `    secoes: ${JSON.stringify(db.secoes, null, 3)}\n`;

            conteudo += "};";
            return conteudo;
        }

        function baixarDados() {
            const conteudo = gerarConteudoDadosJS();
            const blob = new Blob([conteudo], { type: 'text/javascript' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'dados.js';
            link.click();
        }

    </script>
</body>
</html>