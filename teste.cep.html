<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Busca Avan√ßada - P√£o do Ciso</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; max-width: 600px; margin: auto; background-color: #f9f9f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: #5d4037; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; width: 100%; font-weight: bold; }
        button:hover { background: #4e342e; }
        .resultado { background: #e3f2fd; padding: 15px; border-left: 5px solid #2196f3; margin-top: 15px; display: none; }
        .item-lista { border-bottom: 1px solid #ccc; padding: 10px 0; cursor: pointer; }
        .item-lista:hover { background: #f0f0f0; }
        .tag { font-size: 0.7rem; background: #eee; padding: 2px 5px; border-radius: 3px; color: #666; }
    </style>
</head>
<body>

    <h2>üõ†Ô∏è Teste de Busca de Endere√ßo</h2>

    <div class="card">
        <label>Buscar por CEP (Autom√°tico):</label>
        <input type="text" id="cep-input" placeholder="Ex: 12900-000" maxlength="9">
        <div id="res-cep" class="resultado"></div>
    </div>

    <div class="card">
        <label>Buscar CEP por Nome (Rua ou Bairro):</label>
        <input type="text" id="nome-input" placeholder="Ex: Condom√≠nio Baroneza ou Jd. Cedro">
        <button onclick="executarBuscaPorNome()">Pesquisar Endere√ßo</button>
        <div id="lista-resultados" class="resultado"></div>
    </div>

    <script>
        // Configura√ß√µes b√°sicas conforme seus arquivos
        const CIDADE = "Bragan√ßa Paulista";
        const UF = "SP";

        // 1. A L√ìGICA DE RESTRI√á√ÉO (Limpeza de termos)
        function limparTermosBusca(texto) {
            // Termos a serem eliminados conforme sua restri√ß√£o
            const termosRuido = [
                /condom√≠nio/gi, /condominio/gi, /cond\./gi,
                /jardim/gi, /jd\./gi,
                /residencial/gi, /res\./gi,
                /bairro/gi, /parque/gi, /prq\./gi,
                /vila/gi, /loteamento/gi
            ];

            let termoLimpo = texto;
            termosRuido.forEach(reg => {
                termoLimpo = termoLimpo.replace(reg, '');
            });

            return termoLimpo.trim();
        }

        // 2. BUSCA POR NOME NA API VIACEP
        async function executarBuscaPorNome() {
            const input = document.getElementById('nome-input').value;
            const termoReal = limparTermosBusca(input);
            const container = document.getElementById('lista-resultados');

            if (termoReal.length < 3) {
                alert("Por favor, digite um nome mais espec√≠fico (m√≠nimo 3 letras √∫teis).");
                return;
            }

            container.style.display = 'block';
            container.innerHTML = `<i>Buscando por: "<strong>${termoReal}</strong>"...</i>`;

            try {
                // A API ViaCEP exige pelo menos 3 caracteres no termo de busca
                const url = `https://viacep.com.br/ws/${UF}/${CIDADE}/${termoReal}/json/`;
                const response = await fetch(url);
                const dados = await response.json();

                if (!dados.length) {
                    container.innerHTML = "Nenhum resultado encontrado para esse nome.";
                    return;
                }

                container.innerHTML = `<strong>Resultados encontrados:</strong><br>`;
                dados.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'item-lista';
                    div.innerHTML = `
                        <span class="tag">${item.cep}</span><br>
                        <strong>${item.logradouro}</strong><br>
                        <small>${item.bairro} - ${item.localidade}</small>
                    `;
                    container.appendChild(div);
                });

            } catch (e) {
                container.innerHTML = "Erro ao processar busca por nome.";
            }
        }

        // 3. BUSCA POR CEP (L√≥gica original do seu address-manager.js)
        document.getElementById('cep-input').addEventListener('input', async (e) => {
            let v = e.target.value.replace(/\D/g, '');
            if (v.length > 5) v = v.substring(0, 5) + '-' + v.substring(5, 8);
            e.target.value = v;

            if (v.replace('-', '').length === 8) {
                const resDiv = document.getElementById('res-cep');
                resDiv.style.display = 'block';
                resDiv.innerHTML = "Buscando...";
                
                const response = await fetch(`https://viacep.com.br/ws/${v.replace('-','')}/json/`);
                const d = await response.json();
                
                resDiv.innerHTML = d.erro ? "CEP n√£o encontrado" : 
                    `<strong>${d.bairro}</strong><br>${d.logradouro}<br>${d.localidade}/${d.uf}`;
            }
        });
    </script>
</body>
</html>