<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo v3.1 | Pão do Ciso</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-creme: #fdf5e6;
            --verde-militar: #2d3a27;
            --verde-claro: #4a5d42;
            --marrom-cafe: #2e2610;
            --marrom-detalhe: #7d4f39;
            --texto: #3e2723;
            --branco: #ffffff;
            --red: #b22222;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            background: #f4f1ea;
            color: var(--texto);
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 260px;
            background: var(--verde-militar);
            height: 100vh;
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h2 {
            margin: 0;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .menu-item {
            padding: 12px 25px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: 0.3s;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .menu-item i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .btn-save {
            width: 100%;
            background: var(--marrom-detalhe);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
        }

        .btn-save:hover {
            background: #5d3a2a;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .view-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-family: inherit;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .badge-success { background: #e8f5e9; color: #2e7d32; }
        .badge-danger { background: #ffebee; color: #c62828; }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            border: none;
            background: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: 0.2s;
        }

        .btn-edit { color: #1976d2; }
        .btn-delete { color: var(--red); }
        .btn-edit:hover { background: #e3f2fd; }
        .btn-delete:hover { background: #ffebee; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <h2>PÃO DO CISO</h2>
            <small>Painel Administrativo v3.1</small>
        </div>
        
        <nav class="sidebar-menu">
            <a href="#" class="menu-item active" onclick="navegarPara('dashboard')">
                <i class="fas fa-home"></i> Início
            </a>
            <a href="#" class="menu-item" onclick="navegarPara('fornada')">
                <i class="fas fa-calendar-alt"></i> Fornada e Loja
            </a>
            <a href="#" class="menu-item" onclick="navegarPara('produtos')">
                <i class="fas fa-bread-slice"></i> Cardápio
            </a>
            <a href="#" class="menu-item" onclick="navegarPara('entrega')">
                <i class="fas fa-truck"></i> Entrega
            </a>
            <a href="#" class="menu-item" onclick="navegarPara('cupons')">
                <i class="fas fa-tag"></i> Cupons
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn-save" onclick="baixarDados()">
                <i class="fas fa-download"></i> Baixar dados.js
            </button>
            <button class="btn-save" style="margin-top: 10px; background: #4a5d42;" onclick="carregarDadosDoArquivo()">
                <i class="fas fa-sync"></i> Recarregar Arquivo
            </button>
        </div>
    </div>

    <div class="main-content">
        <section id="dashboard" class="view-section active">
            <div class="top-bar">
                <h1>Bem-vindo ao Gestor</h1>
            </div>
            <div class="card">
                <h3>Resumo do Sistema</h3>
                <p>Utilize o menu lateral para gerenciar os produtos, taxas de entrega e informações da próxima fornada.</p>
                <p>Após realizar todas as alterações, clique em <strong>"Baixar dados.js"</strong> e substitua o arquivo na pasta do seu site.</p>
            </div>
        </section>

        <section id="fornada" class="view-section">
            <div class="top-bar">
                <h1>Fornada e Loja</h1>
            </div>
            <div class="card">
                <h3>Configuração da Próxima Fornada</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Data da Fornada (ISO)</label>
                        <input type="date" id="fornada-data">
                    </div>
                    <div class="form-group">
                        <label>Dias de Antecedência</label>
                        <input type="number" id="fornada-antecedencia">
                    </div>
                </div>
                <div class="form-group">
                    <label>Hora Limite para Pedidos</label>
                    <input type="text" id="fornada-hora" placeholder="Ex: 23:59h">
                </div>
            </div>

            <div class="card">
                <h3>Dados de Contato da Loja</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Telefone Exibição</label>
                        <input type="text" id="loja-tel">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp (Somente números)</label>
                        <input type="text" id="loja-whatsapp">
                    </div>
                </div>
                <div class="form-group">
                    <label>Instagram (@...)</label>
                    <input type="text" id="loja-insta">
                </div>
            </div>
        </section>

        <section id="produtos" class="view-section">
            <div class="top-bar">
                <h1>Gerenciar Cardápio</h1>
                <button class="btn-save" onclick="alert('Funcionalidade em desenvolvimento')" style="width: auto; padding: 10px 20px;">
                    <i class="fas fa-plus"></i> Novo Produto
                </button>
            </div>
            <div id="lista-categorias"></div>
        </section>

        <section id="entrega" class="view-section">
            <div class="top-bar">
                <h1>Configurações de Entrega</h1>
            </div>
            <div class="card">
                <div class="form-group">
                    <label>Taxa Geral de Entrega (R$)</label>
                    <input type="number" step="0.01" id="entrega-taxa">
                </div>
            </div>
            <div class="card">
                <h3>Bairros com Taxa Específica</h3>
                <table id="tabela-bairros">
                    <thead>
                        <tr>
                            <th>Bairro</th>
                            <th>Valor (R$)</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="lista-bairros"></tbody>
                </table>
            </div>
        </section>

        <section id="cupons" class="view-section">
            <div class="top-bar">
                <h1>Cupons de Desconto</h1>
                <button class="btn-save" onclick="alert('Funcionalidade em desenvolvimento')" style="width: auto; padding: 10px 20px;">
                    <i class="fas fa-plus"></i> Novo Cupom
                </button>
            </div>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="lista-cupons"></tbody>
                </table>
            </div>
        </section>
    </div>

    <script src="./dados.js"></script>

    <script>
        let db = null;

        function carregarDadosDoArquivo() {
            // Remove qualquer tentativa anterior de carregamento
            const scriptsAntigos = document.querySelectorAll('.script-dados-carga');
            scriptsAntigos.forEach(s => s.remove());

            const script = document.createElement('script');
            
            // O './' força a busca na mesma pasta exata do HTML
            // O '?v=' evita que o navegador ignore mudanças no arquivo dados.js
            script.src = './dados.js?v=' + new Date().getTime();
            script.className = 'script-dados-carga';
            
            script.onload = function() {
                if (window.dadosIniciais) {
                    db = window.dadosIniciais;
                    console.log('Dados carregados com sucesso!');
                    renderizarAtual();
                } else {
                    console.error('Arquivo encontrado, mas a variável window.dadosIniciais não existe.');
                    configurarDadosVazios();
                }
            };

            script.onerror = function() {
                console.error('ERRO: O arquivo "dados.js" não foi encontrado na pasta.');
                alert('ERRO: O arquivo "dados.js" precisa estar na mesma pasta que este HTML.');
                configurarDadosVazios();
            };

            document.head.appendChild(script);
        }

        function configurarDadosVazios() {
            db = {
                fornada: { dataISO: "", diasAntecedencia: 2, horaLimite: "23:59h" },
                entrega: { taxaGeral: 10, bairros: [] },
                cupons: [],
                opcionais: {},
                secoes: [],
                loja: { nome: "PÃO DO CISO" }
            };
            renderizarAtual();
        }

        function navegarPara(id) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            
            const secaoAlvo = document.getElementById(id);
            if(secaoAlvo) secaoAlvo.classList.add('active');

            if(id === 'fornada' && db) carregarInputsFornada();
            if(id === 'entrega' && db) listarBairros();
            if(id === 'cupons' && db) listarCupons();
            if(id === 'produtos' && db) listarProdutos();
        }

        function renderizarAtual() {
            const ativa = document.querySelector('.view-section.active').id;
            navegarPara(ativa);
        }

        function carregarInputsFornada() {
            document.getElementById('fornada-data').value = db.fornada.dataISO;
            document.getElementById('fornada-antecedencia').value = db.fornada.diasAntecedencia;
            document.getElementById('fornada-hora').value = db.fornada.horaLimite;
            document.getElementById('loja-tel').value = db.loja.telefone;
            document.getElementById('loja-whatsapp').value = db.loja.whatsapp;
            document.getElementById('loja-insta').value = db.loja.instagram;
        }

        function listarBairros() {
            const lista = document.getElementById('lista-bairros');
            document.getElementById('entrega-taxa').value = db.entrega.taxaGeral;
            lista.innerHTML = db.entrega.bairros.map((b, i) => `
                <tr>
                    <td>${b.nome}</td>
                    <td>R$ ${b.valor.toFixed(2)}</td>
                    <td class="actions">
                        <button class="btn-icon btn-delete" onclick="removerBairro(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function listarCupons() {
            const lista = document.getElementById('lista-cupons');
            lista.innerHTML = db.cupons.map((c, i) => `
                <tr>
                    <td>${c.codigo}</td>
                    <td>${c.tipo}</td>
                    <td>${c.valor}${c.tipo === 'porcentagem' ? '%' : ' (Fixo)'}</td>
                    <td class="actions">
                        <button class="btn-icon btn-delete" onclick="removerCupom(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function listarProdutos() {
            const container = document.getElementById('lista-categorias');
            container.innerHTML = db.secoes.map((secao, sIdx) => `
                <div class="card">
                    <h3>${secao.nome}</h3>
                    <table>
                        ${secao.itens.map((item, iIdx) => `
                            <tr>
                                <td><strong>${item.nome}</strong></td>
                                <td>R$ ${item.preco.toFixed(2)}</td>
                                <td><span class="badge ${item.esgotado ? 'badge-danger' : 'badge-success'}">${item.esgotado ? 'ESGOTADO' : 'DISPONÍVEL'}</span></td>
                                <td class="actions">
                                    <button class="btn-icon btn-edit" onclick="alternarEsgotado(${sIdx}, ${iIdx})"><i class="fas fa-power-off"></i></button>
                                </td>
                            </tr>
                        `).join('')}
                    </table>
                </div>
            `).join('');
        }

        function alternarEsgotado(sIdx, iIdx) {
            db.secoes[sIdx].itens[iIdx].esgotado = !db.secoes[sIdx].itens[iIdx].esgotado;
            listarProdutos();
        }

        function removerBairro(idx) {
            db.entrega.bairros.splice(idx, 1);
            listarBairros();
        }

        function removerCupom(idx) {
            db.cupons.splice(idx, 1);
            listarCupons();
        }

        function gerarConteudoDadosJS() {
            db.fornada.dataISO = document.getElementById('fornada-data').value;
            db.fornada.diasAntecedencia = parseInt(document.getElementById('fornada-antecedencia').value);
            db.fornada.horaLimite = document.getElementById('fornada-hora').value;
            db.entrega.taxaGeral = parseFloat(document.getElementById('entrega-taxa').value);
            db.loja.telefone = document.getElementById('loja-tel').value;
            db.loja.whatsapp = document.getElementById('loja-whatsapp').value;
            db.loja.instagram = document.getElementById('loja-insta').value;

            return `window.dadosIniciais = ${JSON.stringify(db, null, 4)};`;
        }

        function baixarDados() {
            const conteudo = gerarConteudoDadosJS();
            const blob = new Blob([conteudo], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dados.js';
            a.click();
            URL.revokeObjectURL(url);
        }

        window.onload = carregarDadosDoArquivo;
    </script>
</body>
</html>